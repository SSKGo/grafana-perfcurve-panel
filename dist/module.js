/*! For license information please see module.js.LICENSE.txt */
define(["react","@grafana/ui","@grafana/data","d3","emotion"],(function(e,t,n,r,a){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=5)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t){e.exports=a},function(e,t,n){"use strict";n.r(t);var r=n(2),a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function o(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var l=function(){return(l=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function i(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function u(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),l=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)l.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return l}function c(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(u(arguments[t]));return e}function p(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var s,m,f,d,v=n(0),g=n.n(v),h=n(4),y=n(3),x=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.fill,r=t.stroke,a=t.data,o=t.curveGenerator;return g.a.createElement("g",null,a.map((function(t,a){return g.a.createElement("path",{fill:n,stroke:r,"stroke-width":e.props["stroke-width"],id:"curve-"+100*e.props.index+a,ref:function(e){return y.select(e).datum(t).attr("d",o)}})})))},t}(g.a.PureComponent),b=n(1),C=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.render=function(){var e=this.props,t=e.data,n=e.radius,a=e.xAxis,o=e.yAxis,l=e.xScale,i=e.yScale,u=e.legend;return g.a.createElement("g",null,t.map((function(e){var t=Object(r.formattedValueToString)(Object(r.getValueFormat)(a.unit)(e[0],a.decimals)),c=Object(r.formattedValueToString)(Object(r.getValueFormat)(o.unit)(e[1],o.decimals));return g.a.createElement(b.Tooltip,{content:function(){return g.a.createElement(b.HorizontalGroup,null,g.a.createElement(b.GraphLegend,{items:[u],placement:"over",displayMode:b.LegendDisplayMode.List}),g.a.createElement("div",null,a.label," ",t,", ",o.label," ",c))},theme:"info"},g.a.createElement("circle",{r:String(n),cx:l(e[0]),cy:i(e[1]),fill:u.color}))})))},t}(g.a.PureComponent),E=Object(b.stylesFactory)((function(){return{wrapper:Object(h.css)(m||(m=p(["\n      position: relative;\n    "],["\n      position: relative;\n    "]))),svg:Object(h.css)(f||(f=p(["\n      position: absolute;\n      top: 0;\n      left: 0;\n    "],["\n      position: absolute;\n      top: 0;\n      left: 0;\n    "]))),legend:Object(h.css)(d||(d=p(["\n      position: absolute;\n      bottom: 0;\n      left: 0;\n      padding: 10px;\n    "],["\n      position: absolute;\n      bottom: 0;\n      left: 0;\n      padding: 10px;\n    "])))}})),S=function(e){function t(t){var n=e.call(this,t)||this;return n.state=l({},t.value),n}return o(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.value,r=t.index,a=t.onChangeItem,o=t.onDelete;return g.a.createElement(b.HorizontalGroup,null,g.a.createElement(b.Label,null,"X"),g.a.createElement(b.Input,{type:"text",name:"performCurveX",defaultValue:n.performCurveX,onBlur:function(t){var o=t.currentTarget.value;e.setState((function(){return{performCurveX:o}})),a&&void 0!==r&&a(l(l({},n),{performCurveX:o}),r)}}),g.a.createElement(b.Label,null,"Y"),g.a.createElement(b.Input,{type:"text",name:"performCurveY",defaultValue:n.performCurveY,onBlur:function(t){var o=t.currentTarget.value;e.setState((function(){return{performCurveY:o}})),a&&void 0!==r&&a(l(l({},n),{performCurveY:o}),r)}}),g.a.createElement(b.Label,null,"Color"),g.a.createElement(b.ColorPicker,{color:n.color,onChange:function(t){e.setState((function(){return{color:t}})),a&&void 0!==r&&a(l(l({},n),{color:t}),r)}}),o&&void 0!==r&&g.a.createElement(b.Tooltip,{content:"Delete this performance curve.",theme:"info"},g.a.createElement(b.Button,{variant:"destructive",icon:"trash-alt",size:"sm",onClick:function(){o(r)}},"Remove")))},t}(g.a.PureComponent),F=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onChangeItem=function(e,n){var r=c(t.props.value);r[n]=e,t.props.onChange(r)},t.onAdd=function(e){var n=c(t.props.value,[e]);t.props.onChange(n)},t.onDelete=function(e){var n=c(t.props.value);n.splice(e,1),t.props.onChange(n)},t}return o(t,e),t.prototype.render=function(){var e=this,t=this.props.value;return g.a.createElement(b.VerticalGroup,null,g.a.createElement(b.Tooltip,{content:"Add a new performance curve.",theme:"info"},g.a.createElement(b.Button,{variant:"secondary",size:"sm",icon:"plus",onClick:function(){e.onAdd({performCurveX:"",performCurveY:"",color:Object(r.getColorFromHexRgbOrName)("rgba(136, 136, 136, 0.6)")})}},"Add")),t.map((function(t,n){return g.a.createElement(S,{key:n,value:t,index:n,onChangeItem:e.onChangeItem,onDelete:e.onDelete})})))},t}(g.a.PureComponent),V=function(e){function t(t){var n=e.call(this,t)||this;return n.state=l({},t.value),n}return o(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.value,r=t.index,a=t.onChangeItem,o=t.onDeleteItem;return g.a.createElement(b.HorizontalGroup,null,g.a.createElement(b.Label,null,"X"),g.a.createElement(b.Input,{type:"text",name:"xField",defaultValue:n.xField,onBlur:function(t){var o=t.currentTarget.value;e.setState((function(){return{xField:o}})),a(l(l({},n),{xField:o}),r)}}),g.a.createElement(b.Label,null,"Y"),g.a.createElement(b.Input,{type:"text",name:"yField",defaultValue:n.yField,onBlur:function(t){var o=t.currentTarget.value;e.setState((function(){return{yField:o}})),a(l(l({},n),{yField:o}),r)}}),g.a.createElement(b.Button,{variant:"destructive",icon:"trash-alt",size:"sm",onClick:function(){o(r)}},"Remove"))},t}(g.a.PureComponent),A=function(e){function t(t){var n=e.call(this,t)||this;return n.onChangeItem=function(e,t){var r=c(n.props.value.fieldGroup);r[t]=e,n.props.onChange({fieldGroup:r,color:n.props.value.color},n.props.index)},n.onAddItem=function(e){var t=c(n.props.value.fieldGroup,[e]);n.props.onChange({fieldGroup:t,color:n.props.value.color},n.props.index)},n.onDeleteItem=function(e){var t=c(n.props.value.fieldGroup);t.splice(e,1),n.props.onChange({fieldGroup:t,color:n.props.value.color},n.props.index)},n.state=l({},t.value),n}return o(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.value,r=t.index,a=t.onChange,o=t.onDelete;return g.a.createElement(b.ControlledCollapse,{collapsible:!0,label:"Line Group "+r},g.a.createElement(b.VerticalGroup,null,g.a.createElement(b.HorizontalGroup,null,g.a.createElement(b.Button,{variant:"destructive",icon:"trash-alt",size:"sm",onClick:function(){o(r)}},"Remove Line Group")),g.a.createElement(b.HorizontalGroup,null,g.a.createElement(b.Button,{variant:"secondary",size:"sm",icon:"plus",onClick:function(){e.onAddItem({xField:"",yField:""})}},"Add Field"),g.a.createElement(b.Label,null,"Color"),g.a.createElement(b.ColorPicker,{color:n.color,onChange:function(t){e.setState((function(){return{color:t}})),a(l(l({},n),{color:t}),r)}})),n.fieldGroup.map((function(t,n){return g.a.createElement(V,{key:n,value:t,index:n,onChangeItem:e.onChangeItem,onDeleteItem:e.onDeleteItem})}))))},t}(g.a.PureComponent),P=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onChangeGroup=function(e,n){var r=c(t.props.value);r[n]=e,t.props.onChange(r)},t.onAddGroup=function(e){var n=c(t.props.value,[e]);t.props.onChange(n)},t.onDeleteGroup=function(e){var n=c(t.props.value);n.splice(e,1),t.props.onChange(n)},t}return o(t,e),t.prototype.render=function(){var e=this,t=this.props.value;return g.a.createElement(b.VerticalGroup,null,g.a.createElement(b.Button,{variant:"secondary",size:"sm",icon:"plus",onClick:function(){e.onAddGroup({fieldGroup:[{xField:"",yField:""}],color:Object(r.getColorFromHexRgbOrName)("rgba(136, 136, 136, 0.6)")})}},"Add"),t.map((function(t,n){return g.a.createElement(A,{key:n,value:t,index:n,onChange:e.onChangeGroup,onDelete:e.onDeleteGroup})})))},t}(g.a.PureComponent),O=function(e){function t(t){var n=e.call(this,t)||this;return n.state=l({},t.value),n}return o(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.value,r=t.index,a=t.onChangeItem,o=t.onDelete;return g.a.createElement(b.HorizontalGroup,null,g.a.createElement(b.Label,null,"Label"),g.a.createElement(b.Input,{type:"text",name:"label",defaultValue:n.label,onBlur:function(t){var o=t.currentTarget.value;e.setState((function(){return{label:o}})),a&&void 0!==r&&a(l(l({},n),{label:o}),r)}}),g.a.createElement(b.Label,null,"X"),g.a.createElement(b.Input,{type:"text",name:"xField",defaultValue:n.xField,onBlur:function(t){var o=t.currentTarget.value;e.setState((function(){return{xField:o}})),a&&void 0!==r&&a(l(l({},n),{xField:o}),r)}}),g.a.createElement(b.Label,null,"Y"),g.a.createElement(b.Input,{type:"text",name:"yField",defaultValue:n.yField,onBlur:function(t){var o=t.currentTarget.value;e.setState((function(){return{yField:o}})),a&&void 0!==r&&a(l(l({},n),{yField:o}),r)}}),g.a.createElement(b.Label,null,"Color"),g.a.createElement(b.ColorPicker,{color:n.color,onChange:function(t){e.setState((function(){return{color:t}})),a&&void 0!==r&&a(l(l({},n),{color:t}),r)}}),o&&void 0!==r&&g.a.createElement(b.Tooltip,{content:"Delete this plot.",theme:"info"},g.a.createElement(b.Button,{variant:"destructive",icon:"trash-alt",size:"sm",onClick:function(){o(r)}},"Remove")))},t}(g.a.PureComponent),w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onChangeItem=function(e,n){var r=c(t.props.value);r[n]=e,t.props.onChange(r)},t.onAdd=function(e){var n=c(t.props.value,[e]);t.props.onChange(n)},t.onDelete=function(e){var n=c(t.props.value);n.splice(e,1),t.props.onChange(n)},t}return o(t,e),t.prototype.render=function(){var e=this,t=this.props.value;return g.a.createElement(b.VerticalGroup,null,g.a.createElement(b.Tooltip,{content:"Add a new plot.",theme:"info"},g.a.createElement(b.Button,{variant:"secondary",size:"sm",icon:"plus",onClick:function(){e.onAdd({label:"",xField:"",yField:"",color:Object(r.getColorFromHexRgbOrName)("rgba(136, 136, 136, 0.6)")})}},"Add")),t.map((function(t,n){return g.a.createElement(O,{key:n,value:t,index:n,onChangeItem:e.onChangeItem,onDelete:e.onDelete})})))},t}(g.a.PureComponent),k=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.render=function(){var e=this,t=this.props.value;return g.a.createElement(b.VerticalGroup,null,g.a.createElement(b.HorizontalGroup,null,g.a.createElement(b.Label,null,"Min"),g.a.createElement(b.Input,{type:"number",name:"minValue",value:t.minValue,onChange:function(t){var n=t.currentTarget.value;e.setState((function(){return{minValue:Number(n)}})),e.props.onChange(l(l({},e.props.value),{minValue:Number(n)}))}}),g.a.createElement(b.Label,null,"Max"),g.a.createElement(b.Input,{type:"number",name:"maxValue",defaultValue:t.maxValue,onChange:function(t){var n=t.currentTarget.value;e.setState((function(){return{maxValue:Number(n)}})),e.props.onChange(l(l({},e.props.value),{maxValue:Number(n)}))}}),g.a.createElement(b.Label,null,"Label"),g.a.createElement(b.Input,{type:"text",name:"label",defaultValue:t.label,onChange:function(t){var n=t.currentTarget.value;e.props.onChange(l(l({},e.props.value),{label:n})),e.setState((function(){return{label:n}}))}})),g.a.createElement(b.HorizontalGroup,null,g.a.createElement(b.Label,null,"Unit"),g.a.createElement(b.UnitPicker,{value:t.unit,onChange:function(t){e.props.onChange(l(l({},e.props.value),{unit:t})),e.setState((function(){return{unit:t}}))}}),g.a.createElement(b.Label,null,"Decimals"),g.a.createElement(b.Input,{type:"number",name:"decimals",defaultValue:t.decimals,onChange:function(t){var n=t.currentTarget.value;e.props.onChange(l(l({},e.props.value),{decimals:Number(n)})),e.setState((function(){return{decimals:n}}))}})))},t}(g.a.PureComponent);n.d(t,"plugin",(function(){return G}));var G=new r.PanelPlugin((function(e){var t,n,a=e.options,o=e.data,l=e.width,c=e.height,m=E(),f=20,d=20,v=70,S=60,F=a.performanceCurveData,V=[];try{for(var A=i(F.entries()),P=A.next();!P.done;P=A.next()){var O=u(P.value,2),w=O[0],k=O[1],G=k.performCurveX.split(","),j=k.performCurveY.split(",");V[w]={color:k.color,data:[]};for(var I=0;I<Math.min(G.length,j.length);I++)V[w].data[I]={x:Number(G[I]),y:Number(j[I])}}}catch(e){t={error:e}}finally{try{P&&!P.done&&(n=A.return)&&n.call(A)}finally{if(t)throw t.error}}var L=a.pointRadius,D=[];for(I=0;I<o.series.length;I++){var T=o.series[I].name;D[I]=T||""}var z=[];o.series.map((function(e){if(void 0!==e.name){var t=e.fields.find((function(e){return e.type===r.FieldType.number}));if(t){var n=Object(r.getFieldDisplayName)(t,e);t.name=n,z.push(t)}}else e.fields.map((function(e){if(e.type===r.FieldType.number){var t=e;z.push(t)}}))}));var B=a.plotSetting,N=B.length,X=[[]],_=[],H=function(e){var t=z.find((function(t){return t.name===B[e].xField})),n=z.find((function(t){return t.name===B[e].yField}));if(t&&n){var r=t.values.toArray(),a=n.values.toArray();X[e]=[];for(var o=0;o<r.length;o++)X[e][o]=[r[o],a[o]];_[e]={color:B[e].color,label:B[e].label,isVisible:!0,yAxis:1}}};for(I=0;I<N;I++)H(I);var Y=a.dynamicPerfCurve,R=[],M=function(e){var t=Y[e].fieldGroup;R[e]={color:a.dynamicPerfCurve[e].color,data:[]};for(var n=function(n){var r=z.find((function(e){return e.name===t[n].xField})),a=z.find((function(e){return e.name===t[n].yField}));if(r&&a)for(var o=r.values.toArray(),l=a.values.toArray(),i=0;i<o.length;i++)void 0===R[e].data[i]&&(R[e].data[i]=[]),R[e].data[i][n]={x:o[i],y:l[i]}},r=0;r<t.length;r++)n(r)};for(I=0;I<Y.length;I++)M(I);var U=a.xAxis.minValue,q=a.xAxis.maxValue,J=a.yAxis.minValue,K=a.yAxis.maxValue,Q=function(e,t){var n,a=Object(r.getValueFormat)(t)(0).suffix;return a?e+" ["+(null===(n=a)||void 0===n?void 0:n.trim())+"]":e},W=y.scaleLinear().domain([U,q||0]).range([S,l-d]),Z=y.scaleLinear().domain([J,K||0]).range([c-v,f]),$=y.axisBottom(W).ticks(l/80),ee=y.axisLeft(Z).ticks(c/80),te=y.line().curve(y.curveBasis).x((function(e){return W(e.x)})).y((function(e){return Z(e.y)}));return g.a.createElement("div",{className:Object(h.cx)(m.wrapper,Object(h.css)(s||(s=p(["\n          width: ","px;\n          height: ","px;\n        "],["\n          width: ","px;\n          height: ","px;\n        "])),l,c))},g.a.createElement("svg",{className:m.svg,width:l,height:c,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 "+l+" "+c},g.a.createElement("g",{transform:"translate(0, "+(c-v)+")",ref:function(e){y.select(e).call($)}},g.a.createElement("text",{x:(l-S-d)/2+S,y:"40","text-anchor":"middle",fill:"currentColor","font-size":"8pt"},Q(a.xAxis.label,a.xAxis.unit))),g.a.createElement("g",{transform:"translate("+S+", 0)",ref:function(e){y.select(e).call(ee)}},g.a.createElement("text",{x:-(c-f-v)/2,y:"-50","text-anchor":"middle",fill:"currentColor",transform:"rotate(-90)","font-size":"8pt"},Q(a.yAxis.label,a.yAxis.unit))),g.a.createElement("g",null,W.ticks().map((function(e){return g.a.createElement("line",{stroke:"currentColor","stroke-opacity":"0.1",y1:f,y2:c-v,x1:.5+W(e),x2:.5+W(e)})}))),g.a.createElement("g",null,Z.ticks().map((function(e){return g.a.createElement("line",{stroke:"currentColor","stroke-opacity":"0.1",x1:S,x2:l-d,y1:.5+Z(e),y2:.5+Z(e)})}))),V.map((function(e,t){return g.a.createElement("g",{id:"static-curve-group"},g.a.createElement("path",{fill:"none",stroke:e.color,"stroke-width":"1.5",id:"curve-"+t,ref:function(t){y.select(t).datum(e.data).attr("d",te)}}))})),R.map((function(e,t){return g.a.createElement("g",{id:"dynamic-curve-group"},g.a.createElement(x,{fill:"none",stroke:e.color,"stroke-width":"1.5",index:t,data:e.data,curveGenerator:te}))})),g.a.createElement("g",{id:"plot-group"},X.map((function(e,t){return g.a.createElement(C,{data:e,radius:L,xAxis:a.xAxis,yAxis:a.yAxis,xScale:W,yScale:Z,legend:_[t]})})))),g.a.createElement("div",{className:m.legend},g.a.createElement(b.GraphLegend,{items:_,displayMode:b.LegendDisplayMode.List,placement:"under"})))})).setPanelOptions((function(e){return e.addCustomEditor({category:["Canvas Setting","Axis"],id:"xAxis",path:"xAxis",name:"X-Axis Setting",defaultValue:{minValue:0,maxValue:60,label:"Flowrate",unit:void 0,decimals:void 0},editor:k}).addCustomEditor({category:["Canvas Setting","Axis"],id:"yAxis",path:"yAxis",name:"Y-Axis Setting",defaultValue:{minValue:0,maxValue:100,label:"Pressure",unit:void 0,decimals:void 0},editor:k}).addCustomEditor({category:["Canvas Setting","Performance Curve"],id:"performanceCurveData",path:"performanceCurveData",name:"Static Performance Curve Data",description:"Input sample data points of peformance curve. Program automatically draw smooth lines.",defaultValue:[{performCurveX:"10,20,30,40,50",performCurveY:"80,78,72,62,48",color:Object(r.getColorFromHexRgbOrName)("rgba(136, 136, 136, 0.6)")}],editor:F}).addCustomEditor({category:["Canvas Setting","Performance Curve"],id:"dynamicPerfCurve",path:"dynamicPerfCurve",name:"Dynamic Performance Curve Data",description:"Set filed names to draw dynamic peformance curve. Program automatically draw smooth lines.",defaultValue:[],editor:P}).addCustomEditor({category:["Plot Setting"],id:"plotSetting",path:"plotSetting",name:"Plot Setting",description:"Set field names of X and Y axis to plot operation points. Set alias in query to set field name.",defaultValue:[{label:"Label Name",xField:"Field X",yField:"Field Y",color:Object(r.getColorFromHexRgbOrName)("rgba(136, 136, 136, 0.6)")}],editor:w}).addSelect({category:["Plot Setting"],path:"pointRadius",name:"Point Radius",defaultValue:2,settings:{options:[{label:"0.5",value:.5},{label:"1",value:1},{label:"2",value:2},{label:"3",value:3},{label:"4",value:4},{label:"5",value:5},{label:"6",value:6},{label:"7",value:7},{label:"8",value:8},{label:"9",value:9},{label:"10",value:10}]}})}))}])}));
//# sourceMappingURL=module.js.map